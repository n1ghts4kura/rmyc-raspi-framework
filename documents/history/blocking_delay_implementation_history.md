# é˜»å¡å»¶è¿Ÿæœºåˆ¶å®ç°è®°å½•

## ğŸ“… å®æ–½æ—¶é—´
- **å¼€å‘æ—¥æœŸ**: 2025-10-10
- **ç‰ˆæœ¬**: v1.1
- **å¼€å‘è€…**: n1ghts4kura

## ğŸ¯ å®ç°ç›®æ ‡

å°†ç¡¬ä»¶æ§åˆ¶å‡½æ•°ä»éé˜»å¡æ¨¡å¼å‡çº§ä¸ºå¯é€‰é˜»å¡æ¨¡å¼ï¼Œé€šè¿‡ç†è®ºå»¶è¿Ÿè®¡ç®—ç¡®ä¿æŒ‡ä»¤æ‰§è¡Œå®Œæˆï¼Œæé«˜æ§åˆ¶ç²¾åº¦ã€‚

## ğŸ“‹ å®ç°æ–¹æ¡ˆ

### è®¾è®¡é€‰æ‹©ï¼šdelay å‚æ•°æ§åˆ¶
**ä¼˜äºåŸè®¡åˆ’**ï¼ˆ`uart_feedback_decision_journey.md` ä¸­æè®®çš„ `_wait` åç¼€æ–¹æ¡ˆï¼‰ï¼š

âœ… **ä¼˜åŠ¿**ï¼š
1. **API ç®€æ´**ï¼šæ— éœ€ç»´æŠ¤ä¸¤å¥—å‡½æ•°ï¼ˆ`move_gimbal()` / `move_gimbal_wait()`ï¼‰
2. **çµæ´»æ€§é«˜**ï¼šå¯åŠ¨æ€æ§åˆ¶æ˜¯å¦é˜»å¡ï¼ˆ`delay=True/False`ï¼‰
3. **å‘åå…¼å®¹**ï¼šä¿®æ”¹ `delay=False` å³å¯åˆ‡æ¢ä¸ºéé˜»å¡æ¨¡å¼
4. **ä»£ç å¤ç”¨**ï¼šå…±äº«å‚æ•°éªŒè¯å’Œå‘½ä»¤æ„å»ºé€»è¾‘

âŒ **åŠ£åŠ¿**ï¼ˆå¯æ¥å—ï¼‰ï¼š
- æ— æ³•è·å–æ‰§è¡Œç»“æœåé¦ˆï¼ˆä»ä¾èµ–ç†è®ºè®¡ç®—è€Œéä¸‹ä½æœºç¡®è®¤ï¼‰
- å¯èƒ½å­˜åœ¨ç´¯ç§¯è¯¯å·®ï¼ˆç‰¹åˆ«æ˜¯å¤§è§’åº¦æ—‹è½¬ï¼‰

## ğŸ”§ å…·ä½“å®ç°

### 1ï¸âƒ£ äº‘å°æ¨¡å— (`src/bot/gimbal.py`)

#### æ¨¡å—æ³¨é‡Š
```python
# **æ³¨æ„**: æœ¬æ¨¡å—å­˜åœ¨é˜»å¡å‡½æ•°ï¼Œä¸”**é»˜è®¤å¼€å¯é˜»å¡**ã€‚
```

#### å®ç°å‡½æ•°

| å‡½æ•° | delay å‚æ•° | é»˜è®¤å€¼ | å»¶è¿Ÿè®¡ç®—å…¬å¼ | çŠ¶æ€ |
|------|-----------|--------|-------------|------|
| `set_gimbal_speed()` | âœ… | `True` | `360Â° / max(pitch, yaw, 2)` | âœ… å·²å®ç° |
| `set_gimbal_recenter()` | âœ… | `True` | å›ºå®š `2s`ï¼ˆ360Â°/180Â°/sï¼‰ | âœ… å·²å®ç° |
| `rotate_gimbal()` | âœ… | `True` | `max(abs(pitch), abs(yaw)) / max(vpitch, vyaw, 1)` | âœ… å·²å®ç° |
| `rotate_gimbal_absolute()` | âœ… | `True` | `max(abs(pitch), abs(yaw)) / max(vpitch, vyaw, 1)` | âœ… å·²å®ç° |

#### å…³é”®å®ç°ç»†èŠ‚

```python
def rotate_gimbal(..., delay: bool = True) -> None:
    # ... è¿åŠ¨é€»è¾‘ ...
    
    # ç­‰å¾…
    if delay:
        max_angle = max(abs(pitch) if pitch is not None else 0,
                        abs(yaw) if yaw is not None else 0)
        max_speed = max(vpitch if vpitch is not None else 0,
                        vyaw if vyaw is not None else 0,
                        1)  # é¿å…é™¤é›¶
        wait_time = max_angle / max_speed
        time.sleep(wait_time)
```

**ç‰¹æ®Šå¤„ç†**ï¼š
- **å¤§è§’åº¦åˆ†æ­¥æ‰§è¡Œ**ï¼šå†…éƒ¨åˆ†æ­¥æ—¶æ¯æ­¥éƒ½æœ‰ `time.sleep()`ï¼Œä¸å—å¤–éƒ¨ `delay` å‚æ•°å½±å“
- **å›ä¸­å‡½æ•°**ï¼š`set_gimbal_recenter()` å†…éƒ¨è°ƒç”¨ `_move_gimbal_absolute(0, 0, 180, 180)`ï¼Œè‡ªå¸¦ 2ç§’å»¶è¿Ÿ

### 2ï¸âƒ£ åº•ç›˜æ¨¡å— (`src/bot/chassis.py`)

#### æ¨¡å—æ³¨é‡Š
```python
# **æ³¨æ„**ï¼šè¯¥æ¨¡å—å­˜åœ¨é˜»å¡å‡½æ•°ï¼Œä½†æ˜¯**é»˜è®¤å…³é—­**ã€‚
```

#### å®ç°å‡½æ•°

| å‡½æ•° | delay å‚æ•° | é»˜è®¤å€¼ | å»¶è¿Ÿè®¡ç®—å…¬å¼ | çŠ¶æ€ |
|------|-----------|--------|-------------|------|
| `chassis_move()` | âœ… | `False` | `max(distance/speed_xy, degree/speed_z) + 0.5s` | âœ… å·²å®ç° |
| `set_chassis_speed_3d()` | âŒ | - | æ— å»¶è¿Ÿ | éé˜»å¡ |
| `set_chassis_wheel_speed()` | âŒ | - | æ— å»¶è¿Ÿ | éé˜»å¡ |

#### å…³é”®å®ç°ç»†èŠ‚

```python
def chassis_move(..., delay: bool = False) -> None:
    # ... å‘é€æŒ‡ä»¤ ...
    
    # ç­‰å¾…
    if delay:
        wait_time = 0
        if speed_xy:
            dist = (distance_x ** 2 + distance_y ** 2) ** 0.5
            wait_time = max(wait_time, dist / speed_xy)
        if speed_z and degree_z:
            wait_time = max(wait_time, abs(degree_z) / speed_z)
        import time
        time.sleep(wait_time + 0.5)  # å¤šç­‰0.5ç§’ï¼Œç¡®ä¿å®Œæˆ
```

**è®¾è®¡ç†ç”±**ï¼š
- åº•ç›˜è¿åŠ¨é»˜è®¤**éé˜»å¡**ï¼Œå› ä¸ºï¼š
  1. é€Ÿåº¦æ§åˆ¶åœºæ™¯æ›´å¸¸è§ï¼ˆä¸éœ€ç­‰å¾…ï¼‰
  2. ä½ç½®æ§åˆ¶æ—¶å»¶è¿Ÿè¾ƒé•¿ï¼Œå¼ºåˆ¶é˜»å¡å½±å“çµæ´»æ€§
- ç”¨æˆ·å¯æŒ‰éœ€å¼€å¯ï¼š`chassis_move(..., delay=True)`

### 3ï¸âƒ£ å‘å°„å™¨æ¨¡å— (`src/bot/blaster.py`)

#### å®ç°çŠ¶æ€
âŒ **æœªå®ç°é˜»å¡å»¶è¿Ÿ**

| å‡½æ•° | delay å‚æ•° | çŠ¶æ€ | ç†ç”± |
|------|-----------|------|------|
| `set_blaster_bead()` | âŒ | éé˜»å¡ | å‚æ•°è®¾ç½®ï¼Œæ— éœ€ç­‰å¾… |
| `blaster_fire()` | âŒ | éé˜»å¡ | å‘å°„å»¶è¿Ÿéš¾ä»¥ä¼°ç®—ï¼Œå®æ—¶æ€§è¦æ±‚ä½ |

**è®¾è®¡ç†ç”±**ï¼š
1. å‘å°„å™¨æ§åˆ¶å¯¹å®æ—¶æ€§è¦æ±‚æœ€ä½ï¼ˆä¼˜å…ˆçº§ï¼šäº‘å° > åº•ç›˜ > å‘å°„å™¨ï¼‰
2. å‘å°„å®Œæˆæ—¶é—´éš¾ä»¥ç²¾ç¡®ä¼°ç®—ï¼ˆå¼¹é“ç‰©ç†è¿‡ç¨‹å¤æ‚ï¼‰
3. æµ‹è¯•æ—¶æ‰‹åŠ¨æ·»åŠ  `time.sleep()` å³å¯

## ï¿½ï¿½ è®¾è®¡å“²å­¦å¯¹æ¯”

| æ¨¡å— | é»˜è®¤è¡Œä¸º | è®¾è®¡å“²å­¦ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|---------|
| **äº‘å°** | é˜»å¡ï¼ˆ`delay=True`ï¼‰ | ç²¾å‡†æ§åˆ¶ä¼˜å…ˆ | è‡ªç„ç³»ç»Ÿã€ç²¾ç¡®ç„å‡† |
| **åº•ç›˜** | éé˜»å¡ï¼ˆ`delay=False`ï¼‰ | çµæ´»æ€§ä¼˜å…ˆ | å®æ—¶é€Ÿåº¦æ§åˆ¶ã€å¿«é€Ÿå“åº” |
| **å‘å°„å™¨** | éé˜»å¡ï¼ˆæ—  `delay` å‚æ•°ï¼‰ | ç®€å•ç›´æ¥ | è§¦å‘å¼æ“ä½œ |

## ğŸ§ª æµ‹è¯•è°ƒæ•´å»ºè®®

### test_serial.py ä¿®æ”¹è¦ç‚¹

#### âš ï¸ äº‘å°æµ‹è¯•ï¼šç§»é™¤å†—ä½™ `time.sleep()`
**åŸå› **ï¼šäº‘å°å‡½æ•°é»˜è®¤ `delay=True`ï¼Œå†…éƒ¨å·²é˜»å¡ç­‰å¾…

```python
# âŒ æ—§ä»£ç ï¼ˆå†—ä½™ç­‰å¾…ï¼‰
gimbal.set_gimbal_recenter()
time.sleep(5)  # å†—ä½™ï¼å‡½æ•°å†…éƒ¨å·²ç­‰å¾… 2s

gimbal.rotate_gimbal(pitch=15, yaw=None, vpitch=90, vyaw=None)
time.sleep(2)  # å†—ä½™ï¼å‡½æ•°å†…éƒ¨å·²ç­‰å¾… 15/90â‰ˆ0.17s

# âœ… æ–°ä»£ç ï¼ˆç§»é™¤å†—ä½™ï¼‰
gimbal.set_gimbal_recenter()
time.sleep(0.5)  # ä»…ä¿ç•™çŸ­æš‚åœé¡¿ï¼Œä¾¿äºè§‚å¯Ÿ

gimbal.rotate_gimbal(pitch=15, yaw=None, vpitch=90, vyaw=None)
time.sleep(0.5)  # ä»…ä¿ç•™çŸ­æš‚åœé¡¿ï¼Œä¾¿äºè§‚å¯Ÿ
```

#### âœ… åº•ç›˜æµ‹è¯•ï¼šä¿ç•™ `time.sleep()`
**åŸå› **ï¼š`chassis_move()` é»˜è®¤ `delay=False`ï¼Œéœ€æ‰‹åŠ¨ç­‰å¾…

```python
# âœ… æ­£ç¡®ä»£ç 
chassis.chassis_move(distance_x=0.5, distance_y=0.3, degree_z=90, 
                     speed_xy=0.5, speed_z=90, delay=False)
time.sleep(8)  # å¿…é¡»æ‰‹åŠ¨ç­‰å¾…ç§»åŠ¨å®Œæˆ

# æˆ–ä½¿ç”¨é˜»å¡æ¨¡å¼
chassis.chassis_move(..., delay=True)  # å‡½æ•°å†…éƒ¨è‡ªåŠ¨ç­‰å¾…
# time.sleep() ä¸å†éœ€è¦
```

#### âœ… å‘å°„å™¨æµ‹è¯•ï¼šä¿ç•™ `time.sleep()`
**åŸå› **ï¼šå‘å°„å™¨å‡½æ•°å®Œå…¨éé˜»å¡ï¼Œéœ€æ‰‹åŠ¨ç­‰å¾…

```python
# âœ… æ­£ç¡®ä»£ç 
blaster.blaster_fire()
time.sleep(2)  # å¿…é¡»æ‰‹åŠ¨ç­‰å¾…å‘å°„å®Œæˆ
```

## ğŸ“ æ–‡æ¡£æ›´æ–°æ¸…å•

### âœ… å·²å®Œæˆ
1. âœ… åˆ›å»ºæœ¬æ–‡æ¡£ `blocking_delay_implementation_journey.md`
2. âœ… ä»£ç ä¸­æ·»åŠ æ¨¡å—çº§æ³¨é‡Šï¼ˆ`src/bot/gimbal.py`, `src/bot/chassis.py`ï¼‰
3. âœ… å‡½æ•°æ–‡æ¡£å­—ç¬¦ä¸²åŒ…å« `delay` å‚æ•°è¯´æ˜

### â³ å¾…æ›´æ–°
1. â³ `copilot-instructions.md` - æ›´æ–°"æ§åˆ¶æŒ‡ä»¤åé¦ˆæœºåˆ¶"ç« èŠ‚
2. â³ `uart_feedback_decision_journey.md` - æ·»åŠ å®é™…å®ç°è®°å½•
3. â³ `current_progress.md` - æ·»åŠ é˜»å¡åŒ–æ”¹é€ è®°å½•
4. â³ `tools/test_serial.py` - ç§»é™¤äº‘å°æµ‹è¯•ä¸­çš„å†—ä½™ `time.sleep()`

## ğŸ“ æ ¸å¿ƒæ•™è®­

### 1. ç†è®ºå»¶è¿Ÿ vs å®é™…åé¦ˆ
**ç†è®ºå»¶è¿Ÿè®¡ç®—çš„å±€é™æ€§**ï¼š
- âœ… **ä¼˜ç‚¹**ï¼šç®€å•ã€ä¸ä¾èµ–ä¸‹ä½æœºå“åº”ã€é€‚ç”¨äºå¤§éƒ¨åˆ†åœºæ™¯
- âŒ **ç¼ºç‚¹**ï¼š
  - æ— æ³•ç¡®è®¤æŒ‡ä»¤æ˜¯å¦çœŸæ­£æ‰§è¡Œ
  - å¯èƒ½å­˜åœ¨ç´¯ç§¯è¯¯å·®ï¼ˆç‰¹åˆ«æ˜¯å¤§è§’åº¦æ—‹è½¬ï¼‰
  - ç¡¬ä»¶å¼‚å¸¸æ—¶æ— æ³•åŠæ—¶å‘ç°

**æœªæ¥æ”¹è¿›æ–¹å‘**ï¼š
- æ–¹æ¡ˆ Aï¼šä¿ç•™ç†è®ºå»¶è¿Ÿ + æ·»åŠ åé¦ˆéªŒè¯ï¼ˆå¯é€‰ï¼‰
- æ–¹æ¡ˆ Bï¼šç»“åˆä¸‹ä½æœºçŠ¶æ€æŸ¥è¯¢ç¡®è®¤è¿åŠ¨å®Œæˆ

### 2. ä¸åŒæ¨¡å—çš„é˜»å¡ç­–ç•¥å·®å¼‚
| æ¨¡å— | ç²¾å‡†æ€§è¦æ±‚ | é»˜è®¤é˜»å¡ | ç†ç”± |
|------|-----------|---------|------|
| äº‘å° | **é«˜**ï¼ˆè‡ªç„ï¼‰ | âœ… | ç²¾å‡†æ§åˆ¶ä¼˜å…ˆ |
| åº•ç›˜ | **ä¸­**ï¼ˆé€Ÿåº¦æ§åˆ¶ï¼‰ | âŒ | çµæ´»æ€§ä¼˜å…ˆ |
| å‘å°„å™¨ | **ä½**ï¼ˆè§¦å‘å¼ï¼‰ | âŒ | ç®€å•ç›´æ¥ |

### 3. API è®¾è®¡çš„çµæ´»æ€§ vs ç®€æ´æ€§æƒè¡¡
- **çµæ´»æ€§**ï¼š`delay` å‚æ•°å…è®¸åŠ¨æ€åˆ‡æ¢é˜»å¡/éé˜»å¡
- **ç®€æ´æ€§**ï¼š`delay=True/False` æ¯”ç»´æŠ¤ä¸¤å¥—å‡½æ•°æ›´ç®€æ´
- **å¯å‘ç°æ€§**ï¼šå‚æ•°é»˜è®¤å€¼ä½“ç°è®¾è®¡æ„å›¾ï¼ˆäº‘å°é»˜è®¤é˜»å¡ï¼Œåº•ç›˜é»˜è®¤éé˜»å¡ï¼‰

## ğŸ”— ç›¸å…³æ–‡æ¡£
- `documents/uart_feedback_decision_journey.md` - åŸå§‹è®¾è®¡å†³ç­–
- `documents/current_progress.md` - é¡¹ç›®è¿›åº¦è¿½è¸ª
- `.github/copilot-instructions.md` - å¼€å‘è§„èŒƒ
- `documents/archive/gimbal_360_implementation_journey.md` - äº‘å° 360Â° å®ç°
- `documents/archive/PERFORMANCE_OPTIMIZATION_JOURNEY.md` - æ€§èƒ½ä¼˜åŒ–å†ç¨‹

---

**æœ€åæ›´æ–°**: 2025-10-10  
**çŠ¶æ€**: âœ… å®ç°å®Œæˆï¼Œæ–‡æ¡£å¾…è¡¥å……

---

## åç»­ Bug ä¿®å¤è®°å½•

### 2025-10-10: å…³é”® Bug ä¿®å¤

#### 1. `set_gimbal_speed(0, 0)` å¯¼è‡´çš„é˜»å¡é—®é¢˜ ğŸ›

**é—®é¢˜æè¿°**:
- `test_serial.py` åœ¨ `restore_robot_state()` å‡½æ•°ä¸­å¡ä½
- æ ¹æœ¬åŸå› ï¼š`set_gimbal_speed(0, 0, delay=True)` å¯¼è‡´ 180 ç§’é˜»å¡

**é—®é¢˜åˆ†æ**:
```python
# åŸå§‹ä»£ç 
def set_gimbal_speed(pitch, yaw, delay=True):
    conn.write_serial(f"gimbal speed p {pitch} y {yaw};")
    if delay:
        time.sleep( 360 / max(abs(pitch), abs(yaw), 2) )
        # å½“ pitch=0, yaw=0 æ—¶ï¼š
        # max(0, 0, 2) = 2
        # 360 / 2 = 180 ç§’ï¼ï¼ï¼
```

**ä¿®å¤æ–¹æ¡ˆ**:
```python
def set_gimbal_speed(pitch, yaw, delay=True):
    conn.write_serial(f"gimbal speed p {pitch} y {yaw};")
    if delay:
        # é€Ÿåº¦ä¸º 0 æ—¶ä¸éœ€è¦å»¶æ—¶ï¼ˆåœæ­¢äº‘å°è¿åŠ¨ï¼‰
        if pitch == 0 and yaw == 0:
            return
        time.sleep( 360 / max(abs(pitch), abs(yaw), 2) )
```

**å½±å“èŒƒå›´**:
- `restore_robot_state()` å‡½æ•°ï¼ˆæ¸…ç†æœºå™¨äººçŠ¶æ€æ—¶è°ƒç”¨ï¼‰
- ä»»ä½•éœ€è¦åœæ­¢äº‘å°è¿åŠ¨çš„åœºæ™¯

---

#### 2. äº‘å°å›ä¸­ç«–ç›´æ–¹å‘å¤±æ•ˆé—®é¢˜ ğŸ›

**é—®é¢˜æè¿°**:
- è°ƒç”¨ `set_gimbal_recenter()` æ—¶ï¼Œäº‘å°åœ¨ç«–ç›´æ–¹å‘ï¼ˆpitchï¼‰æ— æ³•æ­£å¸¸å›ä¸­
- å®˜æ–¹ `gimbal recenter;` æŒ‡ä»¤ä¸å¯é 

**æ ¹æœ¬åŸå› **:
- å®˜æ–¹æŒ‡ä»¤ `gimbal recenter;` åœ¨ pitch è½´ä¸Šå­˜åœ¨é—®é¢˜
- ä¹‹å‰ä»£ç ä¸­å·²æœ‰è§£å†³æ–¹æ¡ˆï¼ˆ`_move_gimbal_absolute(0, 0, 180, 180)`ï¼‰ï¼Œä½†è¢«æ³¨é‡Šæ‰äº†

**ä¿®å¤æ–¹æ¡ˆ**:
```python
def set_gimbal_recenter(delay: bool = True) -> None:
    """
    äº‘å°å›ä¸­ï¼ˆpitch=0Â°, yaw=0Â°ï¼‰ã€‚
    
    æ³¨æ„ï¼šå®˜æ–¹ 'gimbal recenter;' æŒ‡ä»¤åœ¨ç«–ç›´æ–¹å‘ä¸Šæ— æ³•æ­£å¸¸å·¥ä½œï¼Œ
    å› æ­¤ä½¿ç”¨å†…éƒ¨ _move_gimbal_absolute(0, 0, 180, 180) å®ç°ã€‚
    """
    # conn.write_serial("gimbal recenter;")  # å®˜æ–¹æŒ‡ä»¤ä¸å¯é 
    _move_gimbal_absolute(0, 0, 180, 180)
    if delay:
        # è®¡ç®—å›ä¸­æ‰€éœ€æ—¶é—´ï¼šå‡è®¾æœ€å¤§åç§» 55Â°ï¼Œé€Ÿåº¦ 180Â°/s
        time.sleep(55 / 180 + 0.5)  # çº¦ 0.8 ç§’
```

**ä¼˜åŒ–æ•ˆæœ**:
- âœ… ä¿®å¤äº† pitch è½´å›ä¸­å¤±æ•ˆé—®é¢˜
- âœ… ä¼˜åŒ–äº†å»¶æ—¶ï¼ˆä» 5 ç§’é™ä½åˆ° ~0.8 ç§’ï¼‰
- âœ… æ·»åŠ äº†è¯¦ç»†çš„æ³¨é‡Šè¯´æ˜

---

#### 3. `open_serial()` è¿æ¥éªŒè¯å¢å¼º ğŸ”§

**éœ€æ±‚èƒŒæ™¯**:
- åŸå§‹å®ç°ä»…æ£€æŸ¥ `serial_conn.is_open`ï¼Œæ— æ³•ç¡®è®¤ä¸‹ä½æœºçœŸå®è¿æ¥çŠ¶æ€
- å‚è€ƒ `test_serial.py` çš„éªŒè¯é€»è¾‘ï¼Œéœ€è¦æ£€æŸ¥ä¸‹ä½æœºå“åº”

**å®ç°æ–¹æ¡ˆ**:
```python
def open_serial() -> bool:
    """
    æ‰“å¼€ UART è¿æ¥ï¼Œå¯åŠ¨åå°æ¥æ”¶çº¿ç¨‹ï¼Œå¹¶éªŒè¯ä¸‹ä½æœºå“åº”ã€‚
    
    Returns:
        (bool) æ˜¯å¦æˆåŠŸæ‰“å¼€å¹¶æ”¶åˆ°ä¸‹ä½æœº ok ç¡®è®¤
    """
    # ... åˆå§‹åŒ–ä¸²å£ ...
    
    # å¯åŠ¨åå°æ¥æ”¶çº¿ç¨‹
    if not start_serial_worker():
        return False
    
    sleep(0.5)  # ç­‰å¾…çº¿ç¨‹å¯åŠ¨
    
    # æ¸…ç©ºæ¥æ”¶ç¼“å†²åŒº
    while get_serial_command_nowait():
        pass
    
    # å‘é€æµ‹è¯•å‘½ä»¤ï¼ŒéªŒè¯ä¸‹ä½æœºå“åº”
    write_serial("version;")
    
    # ç­‰å¾…å¹¶éªŒè¯å“åº”ï¼ˆæœ€å¤š 3 ç§’ï¼‰
    start_time = monotonic()
    while monotonic() - start_time < 3:
        response = get_serial_command_nowait()
        if response and response.strip():
            LOG.info(f"âœ… ä¸‹ä½æœºè¿æ¥ç¡®è®¤æˆåŠŸ: {response.strip()}")
            return True
        sleep(0.1)
    
    LOG.error("âŒ æœªæ”¶åˆ°ä¸‹ä½æœºå“åº”ï¼")
    return False
```

**æ–°å¢åŠŸèƒ½**:
1. **è‡ªåŠ¨å¯åŠ¨åå°æ¥æ”¶çº¿ç¨‹**ï¼šæ— éœ€æ‰‹åŠ¨è°ƒç”¨ `start_serial_worker()`
2. **å‘é€æµ‹è¯•å‘½ä»¤**ï¼šä½¿ç”¨ `version;` éªŒè¯è¿æ¥
3. **å“åº”éªŒè¯**ï¼šç­‰å¾…ä¸‹ä½æœºå“åº”ï¼Œç¡®è®¤è¿æ¥æœ‰æ•ˆ
4. **è¯¦ç»†é”™è¯¯æç¤º**ï¼šè¿æ¥å¤±è´¥æ—¶ç»™å‡ºæ’æŸ¥å»ºè®®

**å½±å“èŒƒå›´**:
- æ‰€æœ‰ä½¿ç”¨ `open_serial()` çš„ä»£ç æ— éœ€ä¿®æ”¹
- è‡ªåŠ¨é›†æˆäº†çº¿ç¨‹å¯åŠ¨å’Œè¿æ¥éªŒè¯
- æé«˜äº†åˆå§‹åŒ–çš„å¯é æ€§

---

## æµ‹è¯•éªŒè¯

### ä¿®å¤å‰çš„é—®é¢˜
```bash
# test_serial.py å¡ä½åœ¨:
restore_robot_state()  # 180 ç§’é˜»å¡

# äº‘å°å›ä¸­æ— æ•ˆ:
gimbal.set_gimbal_recenter()  # pitch è½´ä¸åŠ¨
```

### ä¿®å¤åçš„æ•ˆæœ
```bash
# æ­£å¸¸æ¸…ç†:
restore_robot_state()  # çº¦ 1 ç§’å®Œæˆ

# äº‘å°æ­£ç¡®å›ä¸­:
gimbal.set_gimbal_recenter()  # pitch å’Œ yaw éƒ½å›åˆ° 0Â°

# è¿æ¥éªŒè¯å¢å¼º:
open_serial()  # è‡ªåŠ¨éªŒè¯ä¸‹ä½æœºå“åº”
```

---

## ç»éªŒæ€»ç»“

### 1. è¾¹ç•Œæ¡ä»¶æ£€æŸ¥çš„é‡è¦æ€§ âš ï¸
- **æ•™è®­**ï¼š`set_gimbal_speed(0, 0)` è¿™ç§"åœæ­¢è¿åŠ¨"çš„è¾¹ç•Œæƒ…å†µå®¹æ˜“è¢«å¿½ç•¥
- **ç»éªŒ**ï¼šä»»ä½•æ¶‰åŠæ•°å­¦è®¡ç®—çš„å»¶æ—¶é€»è¾‘ï¼Œéƒ½è¦æ£€æŸ¥åˆ†æ¯ä¸º 0 æˆ–æå°å€¼çš„æƒ…å†µ
- **è§„èŒƒ**ï¼šæ·»åŠ è¾¹ç•Œæ¡ä»¶å•å…ƒæµ‹è¯•

### 2. å®˜æ–¹ API å¯é æ€§éªŒè¯ ğŸ”
- **æ•™è®­**ï¼šå®˜æ–¹æ–‡æ¡£ä¸­çš„ `gimbal recenter;` æŒ‡ä»¤å­˜åœ¨ bug
- **ç»éªŒ**ï¼šç¡¬ä»¶æ§åˆ¶ API éœ€è¦å®æµ‹éªŒè¯ï¼Œä¸èƒ½å®Œå…¨ä¾èµ–æ–‡æ¡£
- **è§„èŒƒ**ï¼šå…³é”®åŠŸèƒ½æä¾›å¤‡ç”¨å®ç°æ–¹æ¡ˆï¼ˆå¦‚å†…éƒ¨å‡½æ•°ï¼‰

### 3. è¿æ¥éªŒè¯çš„å¿…è¦æ€§ âœ…
- **æ•™è®­**ï¼š`serial_conn.is_open` ä»…è¡¨ç¤ºç«¯å£æ‰“å¼€ï¼Œä¸ä»£è¡¨ä¸‹ä½æœºå“åº”
- **ç»éªŒ**ï¼šç¡¬ä»¶è¿æ¥å¿…é¡»é€šè¿‡"å‘é€-æ¥æ”¶"éªŒè¯çœŸå®çŠ¶æ€
- **è§„èŒƒ**ï¼šåˆå§‹åŒ–å‡½æ•°é›†æˆå®Œæ•´çš„éªŒè¯é€»è¾‘

### 4. ä»£ç æ³¨é‡Šçš„ä»·å€¼ ğŸ“
- **å‘ç°**ï¼š`set_gimbal_recenter()` ä¸­æ³¨é‡Šçš„ `_move_gimbal_absolute(0, 0, 180, 180)` æ›¾æ˜¯è§£å†³æ–¹æ¡ˆ
- **æ•™è®­**ï¼šä¸è¦è½»æ˜“åˆ é™¤æ³¨é‡Šçš„ä»£ç ï¼Œå®ƒå¯èƒ½åŒ…å«é‡è¦çš„è®¾è®¡å†³ç­–
- **è§„èŒƒ**ï¼šæ³¨é‡Šå…³é”®ä»£ç æ—¶ï¼Œè¯´æ˜ä¸ºä»€ä¹ˆæ³¨é‡Šï¼ˆè€Œä¸æ˜¯ç›´æ¥åˆ é™¤ï¼‰

---

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

- âœ… `src/bot/gimbal.py`
  - ä¿®å¤ `set_gimbal_speed()` çš„ delay è®¡ç®—é€»è¾‘
  - ä¿®å¤ `set_gimbal_recenter()` ä½¿ç”¨å†…éƒ¨å‡½æ•°å®ç°

- âœ… `src/bot/conn.py`
  - å¢å¼º `open_serial()` è¿æ¥éªŒè¯é€»è¾‘
  - é›†æˆåå°çº¿ç¨‹å¯åŠ¨å’Œå“åº”éªŒè¯

- âœ… `documents/blocking_delay_implementation_journey.md`
  - æ·»åŠ  Bug ä¿®å¤è®°å½•ï¼ˆæœ¬æ–‡æ¡£ï¼‰
