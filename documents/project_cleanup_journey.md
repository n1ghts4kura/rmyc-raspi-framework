# 项目清理 Journey

## 时间线
- **启动时间**: 2025年10月3日
- **背景**: 性能调优完成后，对项目进行全面清理

## 清理背景

### 问题识别
在完成性能调优（0.72 FPS → 4.15 FPS）并创建了详细的 PERFORMANCE_OPTIMIZATION_JOURNEY.md 后，我们发现项目中存在以下问题：

1. **测试文件过多且功能重复**：多个 `test_*.py` 文件用于不同阶段的测试，但随着框架体系的完善，这些文件已经失去作用
2. **工具脚本冗余**：部分工具脚本在早期探索阶段创建，现在已被更好的方案替代
3. **文档过时**：部分文档记录的是过时的设计或已被放弃的方案
4. **可读性问题**：`test_annotation.py` 的定位不清晰（既是测试又是演示工具）

### 用户的核心疑虑

在清理前，用户对 `test_annotation.py` 提出了重要的保留理由：

> "test_annotation在我眼中有几个作用：
> 1. 用于在SSH环境中测试视觉系统（没有桌面环境）
> 2. 用于在桌面环境中查看识别效果
> 3. 性能测试和调试工具
> 
> 所以它不应该被删除，但需要重命名和简化。"

这个反馈让我们意识到：**不是所有测试文件都应该删除，而是要保留有实际价值的工具，并给它们更准确的定位。**

## 清理决策

### 保留并重构
- **test_annotation.py → demo_vision.py**
  - 重命名以反映其"演示工具"的定位
  - 简化代码：从 167 行精简到 120 行
  - 保留核心功能：
    - HAS_DISPLAY 自动检测（SSH/桌面环境兼容）
    - 智能休眠机制（SSH 环境下节省资源）
    - 性能统计（FPS 监控）
    - 可视化标注（桌面环境）

### 删除的测试脚本（3个）
1. **test_inference_loop.py** (约 150 行)
   - 作用：测试推理循环性能
   - 删除理由：功能已被 `demo_vision.py` 完全覆盖
   
2. **test_low_power.py** (约 80 行)
   - 作用：测试低功耗模式
   - 删除理由：早期探索，现已有完整的电源管理方案
   
3. **test_onnx_performance.py** (约 120 行)
   - 作用：ONNX Runtime 性能基准测试
   - 删除理由：性能调优已完成，基准数据已记录在文档中

### 删除的工具脚本（6个）
1. **benchmark_ncnn.py** (约 200 行)
   - 删除理由：已放弃 NCNN Vulkan 方案，改用 ONNX Runtime CPU
   
2. **test_camera.py** (约 100 行)
   - 删除理由：摄像头功能已集成到 `recognizer.py`
   
3. **convert_to_ncnn.py** (约 150 行)
   - 删除理由：与 NCNN 相关，已无用
   
4. **check_inference_backend.py** (约 80 行)
   - 删除理由：后端已确定为 ONNX Runtime CPU
   
5. **profile_yolo.py** (约 120 行)
   - 删除理由：性能分析已完成
   
6. **setup_opencv.sh** (约 50 行)
   - 删除理由：OpenCV 安装已标准化（requirements.txt）

保留的核心工具（5个）：
- `convert_pt_to_onnx.py`：模型格式转换（常用）
- `set_cpu_performance.sh`：临时性能模式切换
- `install_cpu_performance_service.sh`：系统服务安装
- `uninstall_cpu_performance_service.sh`：系统服务卸载
- `verify_power.sh`：电源诊断（重要）

### 删除的过时文档（2个）
1. **OLD_ARCHITECTURE.md** (约 300 行)
   - 删除理由：描述的是早期架构，已被 `general_intro_for_ai.md` 替代
   
2. **NCNN_EXPLORATION.md** (约 250 行)
   - 删除理由：NCNN 方案已放弃，相关内容已整合到 PERFORMANCE_OPTIMIZATION_JOURNEY.md

保留的核心文档（5个）：
- `general_intro_for_ai.md`：项目架构和设计理念
- `aimassistant_intro_for_ai.md`：自瞄系统设计（开发中）
- `repl.md`：REPL 工具使用说明
- `PERFORMANCE_OPTIMIZATION_JOURNEY.md`：性能调优完整记录
- `PERFORMANCE_OPTIMIZATION_SUMMARY.md`：性能优化总结

## 清理统计

### 文件数量
- 删除测试脚本：3 个
- 删除工具脚本：6 个
- 删除过时文档：2 个
- **总计删除：11 个文件**

### 代码行数（估算）
- 删除测试代码：约 350 行
- 删除工具代码：约 700 行
- 删除文档内容：约 550 行
- 简化 demo_vision.py：减少 47 行
- **总计减少：约 1647 行**

### 保留与优化
- 保留核心工具：5 个
- 保留核心文档：5 个
- 重构演示工具：1 个（demo_vision.py）

## 清理影响

### 正面影响
1. **可读性提升**：文件数量从 20+ 减少到 10+，目录结构更清晰
2. **维护成本降低**：不再需要维护过时的测试和工具
3. **新人友好**：减少了无用文件的干扰，降低理解门槛
4. **文档同步**：只保留最新的文档，避免混淆

### 潜在风险
1. **历史信息丢失**：删除的文件包含一些早期探索的记录
   - **缓解措施**：已在 PERFORMANCE_OPTIMIZATION_JOURNEY.md 中记录了关键决策
   
2. **工具依赖**：如果未来需要重新测试某些功能，可能需要重写工具
   - **缓解措施**：Git 历史中仍可找回删除的文件

## 关键经验

### 1. 测试文件的生命周期
测试文件不应该永久保留，应该：
- 在探索阶段创建
- 在验证阶段使用
- 在稳定后删除或重构为工具

### 2. 工具与测试的区别
- **测试**：验证功能正确性，用完即弃
- **工具**：辅助开发和调试，长期保留
- `test_annotation.py` 的重命名就是这个理念的体现

### 3. 文档的时效性
- 过时的文档比没有文档更糟糕（误导性）
- 定期清理过时文档，保持文档与代码同步
- 使用 `*_journey.md` 记录历史决策，而不是保留过时的设计文档

### 4. "最小化但完整"原则
- 保留的文件应该：
  - 有明确的用途
  - 经常被使用
  - 无法被其他文件替代
- 删除的文件应该：
  - 功能重复
  - 长期未使用
  - 已有更好的替代方案

## 后续计划

### 立即行动
1. ✅ 更新 PERFORMANCE_OPTIMIZATION_JOURNEY.md，标注已删除的文件引用
2. ⏳ 更新 Copilot Instructions，反映新的项目结构
3. ⏳ Git 提交：记录这次重大清理

### 长期维护
1. 每月审查一次文件清单，识别可以清理的文件
2. 新增文件时明确其定位（测试/工具/文档）
3. 建立"文件保留清单"，定期评估每个文件的价值

## 反思与总结

这次清理让我们认识到：

1. **不要害怕删除代码**：Git 会保留历史，删除不是永久的
2. **保留有价值的工具**：demo_vision.py 的重构证明了这一点
3. **文档化决策过程**：这个 journey 文档本身就是最好的例子
4. **定期清理是必要的**：代码和文档都会"腐烂"，需要定期维护

这次清理删除了约 1647 行代码和 11 个文件，但项目的核心功能和可维护性都得到了提升。这是一次成功的项目整理。

---

**创建时间**: 2025年10月3日  
**作者**: n1ghts4kura (with GitHub Copilot)
