# Sequentially Thinking / 输出结构规范草稿

> 本文是拟合入 `.github/copilot-instructions.md` 的草稿，用于约定「分步思考（CoT）+ 输出结构分级」。
> 你可以在确认后，将其中需要的部分合并进正式说明文档。

---

## 🤔 Sequentially Thinking（分步思考习惯）

### 1. 概念定义

- **Sequentially Thinking**：在给出答案之前，先在内部把问题拆解成若干关键子问题或步骤，并按顺序进行推理。
- 它本质上是一种 **CoT（Chain-of-Thought）思维习惯**，不是 VS Code 插件、也不是某个“模式开关”。
- 目标：
  - 在处理复杂任务时减少遗漏（文件、边界条件、文档同步、验证步骤）；
  - 在硬件、性能、架构相关改动上提供更稳妥的方案，而不是拍脑袋式修改。
- 对用户来说：
  - 用户最终看到的是**整理后的结构化结果**；
  - 内部更细颗粒度的思考过程不需要全部原样暴露，只在合适位置以精简形式呈现。

### 2. 何时必须/建议进行分步思考

> 下面列出的场景中，**强烈建议先做分步思考，再组织输出结构**。

- **改动范围较大**：
  - 预计会修改或新增 **≥2 个文件**；
  - 或预计新增/修改 **≥30 行代码**（单次回答内）。
- **影响架构或控制流**：
  - 修改模块间依赖关系、导入结构；
  - 调整线程模型、消息/事件流、异步任务调度；
  - 改写关键算法或数据结构。
- **涉及性能敏感区域**：
  - 高频调用路径（> 10Hz 控制循环）；
  - 自瞄控制环路、视觉推理、串口通信收发线程；
  - 有明确实时性/延迟要求的逻辑。
- **存在多方案权衡**：
  - 需要在性能、可读性、维护成本、硬件限制之间做取舍；
  - 或用户提到“比较方案 / 设计取舍 / trade-off”。
- **需求或上下文存在不确定性**：
  - 用户描述含糊，缺少关键参数（速度、角度、平台限制等）；
  - 新接触的功能域（第一次修改 UART、gimbal、自瞄 pipeline 等）；
  - 历史行为与当前期望有矛盾，需要澄清。

> 相反，对于以下场景，**可以直接给简洁答案**，不必显式展开完整分步结构：
>
> - “what is / where is / explain X” 这类简单解释问题；
> - 只需补充 1–2 行类型标注、拼写修正或明显 bugfix，且不影响架构/性能；
> - 纯文档小修正（单词/格式），不涉及逻辑含义变化。

### 3. 内部分步思考流程模板

> 以下是推荐的**内部思考流程**，不要求逐字照搬，但应大致遵循。

1. **重述任务与目标**
   - 用自己的话在内部确认：
     - 用户到底要解决什么问题；
     - 期望的输入/输出是什么；
     - 有哪些显式或隐含约束（硬件平台、性能、时间、风险）。

2. **识别影响面与风险点**
   - 涉及哪些模块、文件、文档（例如 `src/bot/`、`src/aimassistant/`、`docs/intro/*`）；
   - 是否触及：
     - 硬件控制安全（底盘、云台、发射器）；
     - 性能敏感路径（视觉、自瞄、串口）；
     - 严格协议约束（RoboMaster SDK 文本协议）。
   - 初步列出可能的风险：越界、阻塞、线程安全、文档不同步等。

3. **列出 1–3 个候选策略（如有）**
   - 粗略对比：
     - 实现复杂度；
     - 对现有代码侵入性；
     - 性能影响与未来扩展空间。
   - 对明显劣势方案可在内部直接淘汰，不必对用户详细展开。

4. **选定方案并拆解执行步骤**
   - 以 3–7 条 bullet 的形式，划分从“当前状态”到“目标状态”的路径：
     - 哪些文件要改；
     - 每个文件中的关键改动点；
     - 需要新增/调整的配置项或常量；
     - 涉及到的测试或 REPL 验证步骤。

5. **考虑文档和验证**
   - 根据变更类型，决定是否需要更新：
     - `docs/status.md`、`docs/index.md`、`docs/plans.md`、`docs/principles.md`；
     - `docs/intro/<module>_intro.md`；
     - `docs/journey/<topic>_journey.md` 或 decision journey；
   - 设计验证路径：
     - 单模块测试 / REPL 调试 / 实机测试；
     - 验证成功/失败各自的预期观察点。

> 最终对用户展示时，只需要在「分析与规划」小节中以**压缩版**呈现这些思考结论，而不是逐字 dump 全部内部推理。

---

## 📤 输出结构与复杂度分级

> 本节约定：根据任务复杂度选择不同级别的输出结构，既保证清晰度，又避免对简单问题过度结构化。

### 1. 级别 A：简单问题（Minimal Answer）

- **适用场景**：
  - 对单个符号/函数/文件的解释（"what is / where is / explain"）；
  - 只需给出结论或一个很小的建议，不涉及代码改动。
- **输出要求**：
  - 直接、简短地回答问题，通常 **≤ 3–5 句**；
  - 不强制使用章节标题；
  - 可以顺带给出 1–2 条额外建议（例如指向 `docs/intro/...`），但不是必须。

### 2. 级别 B：中等复杂度任务（Single-Feature / Single-File）

- **适用场景**：
  - 主要集中在 **单个文件** 或非常有限的范围内的改动；
  - 预计改动 **< 30 行代码**，且不触及架构、硬件安全或性能敏感路径；
  - 例如：为某个函数补上类型标注与注释，对单个技能逻辑做小幅调整等。
- **推荐输出结构（轻量版）**：
  1. **任务理解**（1–2 句）
     - 用自己的话简要复述用户需求，确保上下文一致。
  2. **关键修改/建议要点**（2–5 个 bullet）
     - 概要说明要在什么地方做什么改动；
     - 不必展开所有细节代码，但要覆盖关键设计决策。
  3. **验证建议（可选）**
     - 1–3 句说明如何快速验证改动是否正确；
     - 可以是 REPL 命令、脚本调用或简单的运行步骤。

### 3. 级别 C：复杂任务（Multi-File / Architecture / Hardware）

- **适用场景**：
  - 满足「分步思考触发条件」的任何任务，尤其是：
    - 多文件、多模块、多层级交互的改动；
    - 涉及底盘/云台/发射器控制、RoboMaster SDK 协议、视觉推理、自瞄策略等；
    - 涉及重大重构、性能优化或设计方案对比。
- **强制输出结构**：
  1. **任务理解**
     - 1–3 句，明确当前要解决的问题、期望结果和关键约束。
  2. **分析与规划**（显式展示压缩版 CoT）
     - 用 3–7 条 bullet 简要说明：
       - 关键考虑点（风险、依赖、trade-off）；
       - 准备采取的主要步骤（按阶段或按文件划分）。
  3. **实现 / 改动说明**
     - 按文件或模块分组，概述每处改动的核心内容；
     - 对重要决策给出简短理由（尤其是与硬件、安全、性能相关的）。
  4. **文档更新**
     - 列出需要更新的文档（如 `docs/status.md`、`docs/intro/...`、`docs/journey/...`）；
     - 对每个文档给出简短的更新要点，而不是完整正文。
  5. **验证步骤**
     - 说明如何在开发机/树莓派/实机环境中验证变更；
     - 明确预期行为与失败时的典型症状。
  6. **结论与后续建议**
     - 总结本次回答达成了什么；
     - 提出潜在风险、TODO 或未来可选优化方向。

> 只要任务命中「必须/强烈建议分步思考」的条件，就应按 **级别 C** 组织输出结构。

---

## 🧠 CoT 可见性与反模式

### 1. 何时展示部分推理步骤

- 对于 **级别 C** 任务：
  - 必须在「分析与规划」小节中简要展示推理框架；
  - 用 3–7 条 bullet 表达关键考虑点和行动步骤即可；
  - 不需要也不建议暴露所有细枝末节的内部尝试。
- 对于 **级别 B** 任务：
  - 可以用 1–2 句说明为什么选择某种修改方式或方案；
  - 不需要一整段完整的 CoT，只点出关键取舍。
- 对于 **级别 A** 任务：
  - 默认不展示 CoT，只返回清晰直接的结论；
  - 只有当用户明确要求“详细推理过程”时，才适当展开。

### 2. 避免的反模式

- 不要为非常简单的问题强行套用 6 段复杂结构，增加阅读负担；
- 不要无筛选地倾倒全部内部思考过程，变成冗长的流水账；
- 不要为了显得“复杂”而故意把适合 B 级的问题写成 C 级结构；
- 不要因为懒得思考而在复杂任务中只给一段模糊结论，缺少分析和验证安排。

---

## 🔗 与其他章节的关系（嵌入提示）

在将本草稿合并进 `.github/copilot-instructions.md` 时，建议：

- 在「Key Principles Summary」中增加或修改一条：
  - **复杂任务先进行分步思考（Sequentially Thinking / CoT），并按 A/B/C 级结构输出；简单问题直接给结论。**
- 在现有的「Output Format Requirements」章节开头引用本节：
  - 说明输出结构应根据任务复杂度选择 A/B/C 级；
  - 命中复杂任务条件时必须使用 C 级结构，并在「分析与规划」中展示压缩版 CoT。
- 在涉及测试与文档同步的原则中补一句：
  - 将「文档更新」和「验证步骤」视作复杂任务分步思考中的**固定阶段**，而不是事后补救动作。

> 以上内容为草稿，你可以按需删减或重排后合并到正式的 `copilot-instructions.md` 中。