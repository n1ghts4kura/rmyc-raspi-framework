# 项目计划（Plans）

> 本文档从**子系统视角**梳理本项目的「已完成 / 正在进行 / 可能的下一步」，
> 并在顶部给出一条非常精简的版本时间线，帮助人类与 LLM 在阅读其他文档时
> 快速对齐当前所处阶段。

---

## 0. 精简版本时间线（Version Timeline Snapshot）

- **v1.0 — 核心框架成型**  
  - 时间：过去版本（已完成）  
  - 关键成果：  
    - 串口通信与基础硬件控制（`src/bot/`）初步可用；  
    - 技能系统与示例技能（`src/skill/`）搭建完成；  
    - 视觉识别与模型加载基础能力（`src/recognizer.py` + `model/`）就绪；  
    - 日志、配置等基础支撑模块落地（`logger.py`、`config.py`、`utils.py`）。

- **v1.1 — 自瞄闭环与文档体系雏形**  
  - 当前大版本（进行中 / 收尾中）  
  - 关键目标：  
    - 打通从视觉识别 → 目标选择 → 角度计算 → 云台 / 发射控制的自瞄闭环；  
    - 构建 REPL 调试工具与 CPU 性能脚本，用于实机调试与性能验证；  
    - 建立面向人类与 LLM 的文档骨架（`index.md`、`status.md`、`principles.md` 等）。

- **v1.1re — 文档与 LLM 协作重构**  
  - 当前小版本（`dev_v1_1_re` 分支，对应当前阶段）  
  - 关键目标：  
    - 明确文档类型与命名规范（`*_intro.md`、`*_journey.md` 等）；  
    - 通过 `status.md`、`plans.md`、`principles.md` 等文档，为后续按需文档生成打好基础；  
    - 梳理项目通用原则与计划，让 LLM 能在开发中主动对齐这些约定。

> 说明：未来版本（如 v1.2 及之后）的具体规划尚未固定，
> 可在本文件后续迭代中逐步补充。

---

## 1. 通信与硬件抽象层计划（`src/bot/`）

### 1.1 已完成的工作（Past）

- 建立基本的硬件抽象模块：  
  - `conn.py`：串口连接与数据收发封装；  
  - `robot.py`：机器人整体对象与模块聚合；  
  - `chassis.py`、`gimbal.py`、`blaster.py`：底盘、云台、发射器控制接口；  
  - `sdk.py`、`game_msg.py`：与 RoboMaster SDK 协议和比赛消息的基础封装。  
- 将硬件相关逻辑集中在 `src/bot/` 下，避免业务层直接操作底层协议。

### 1.2 正在进行的工作（Present）

- 在树莓派环境上逐步验证：  
  - 串口连接与基础命令发送的稳定性与错误处理；  
  - 底盘 / 云台 / 发射器的基础动作是否符合预期。  
- 在文档侧，通过 `status.md` 标记验证进度（例如：在树莓派上完成约多少比例的测试）。

### 1.3 可能的下一步（Near Future）

- 补充或优化以下能力：  
  - 更细致的错误分类与恢复策略（超时、断线、非法数据等）；  
  - 更严格的参数校验与安全边界（避免危险动作）；  
  - 针对高频指令与批量命令的性能优化。  
- 在文档层面，建议后续新增：  
  - `bot_intro.md`（或类似命名），系统性说明硬件抽象层的设计与接口；  
  - 对应的 `bot_journey.md`，记录与 RoboMaster SDK 对接过程中的经验与坑点。

---

## 2. 视觉识别计划（`src/recognizer.py` + `model/`）

### 2.1 已完成的工作（Past）

- 引入多种格式的 YOLOv8 模型：ONNX、PyTorch、NCNN（`model/` 目录）。  
- 在 `src/recognizer.py` 中搭建基础推理入口，用于加载模型并对输入图像进行检测。  
- 提供 `demo_vision.py` 作为视觉能力的简单示例/入口。

### 2.2 正在进行的工作（Present）

- 在开发机环境下验证模型加载与推理流程的正确性；  
- 评估在树莓派上的推理性能（FPS、延迟）与资源占用情况（计划中 / 进行中）。

### 2.3 可能的下一步（Near Future）

- 针对目标平台（树莓派）的性能优化：  
  - 选择更合适的模型格式与尺寸（例如 NCNN、轻量化模型等）；  
  - 优化预处理与后处理逻辑，减少不必要的开销。  
- 与自瞄系统更紧密地集成：  
  - 定义清晰的检测结果数据结构（用于 selector / pipeline）；  
  - 在文档中说明检测类别、置信度阈值等关键参数。  
- 在文档层面，建议后续新增：  
  - `vision_intro.md`：说明视觉系统架构、模型选择与性能权衡；  
  - 相关 `vision_journey.md`：记录模型选型与性能调优的历程。

---

## 3. 自瞄系统计划（`src/aimassistant/` + `src/skill/autoaim.py`）

### 3.1 已完成的工作（Past）

- 建立自瞄关键模块：  
  - `aimassistant/angle.py`：角度计算相关工具与逻辑；  
  - `aimassistant/pipeline.py`：自瞄主流程管线；  
  - `aimassistant/selector.py`：目标选择策略；  
  - `skill/autoaim.py`：将自瞄能力封装为技能，与整体技能系统集成。  
- 在配置与文档中预留了与自瞄相关的关键参数位置（例如 FOV、云台速度等）。

### 3.2 正在进行的工作（Present）

- 逐步打通从视觉检测结果到实际云台/发射器动作的闭环：  
  - 确认 selector 的目标选择策略在真实比赛场景下是否合理；  
  - 在实机上验证角度计算与云台控制接口的匹配程度。  
- 在 `status.md` 中，将自瞄系统的各个环节完成度拆分标记，方便后续跟踪。

### 3.3 可能的下一步（Near Future）

- 完成并记录首次完整自瞄闭环测试：  
  - 包括测试场景、参数配置、命中率 / 反应时间等关键指标；  
  - 在未来的 `aimassistant_journey.md` 中记录测试过程与结论。  
- 探索不同的目标排序与优先级策略（例如按距离、威胁度等），并比较效果；  
- 结合比赛规则与实际需求，对自瞄行为增加“安全策略”（如禁止特定角度、避免友军）。  
- 在文档层面，优先补充：  
  - `aimassistant_intro.md`：给出整体架构与数据流说明；  
  - `aimassistant_journey.md`：记录从“能打”到“打得好”的演进过程。

---

## 4. 技能系统计划（`src/skill/`）

### 4.1 已完成的工作（Past）

- 构建技能系统基础框架：  
  - `skill/manager.py`：技能管理与触发调度；  
  - `skill/base_skill.py`：技能基类与统一接口约定；  
  - `skill/example_skill.py`：示例技能，用于演示技能系统的使用方法。  
- 在 `main.py` / 相关入口中，预留技能注册与组合点。

### 4.2 正在进行的工作（Present）

- 将自瞄相关能力集成为具体技能（`skill/autoaim.py`），并在整体流程中验证：  
  - 技能生命周期（启动、运行、停止）的行为是否符合预期；  
  - 与底层控制模块之间的耦合度是否合理。  
- 思考未来是否需要更复杂的技能编排（优先级、互斥、条件触发等）。

### 4.3 可能的下一步（Near Future）

- 增加更多实用技能（如快速位移、预设姿态切换等）以支撑不同战术；  
- 根据实际使用反馈，调整技能 API 与事件机制；  
- 在文档层面新增：  
  - `skill_intro.md`（或类似）说明技能系统的设计思想与扩展方式；  
  - 对应的 `skill_journey.md`，记录技能系统从简单到复杂的演进和取舍。

---

## 5. 文档与 LLM 协作计划（`docs/` + `.github/`）

### 5.1 已完成的工作（Past）

- 建立文档与 LLM 协作的核心骨架：  
  - `.github/copilot-instructions.md`：定义 LLM 角色、行为约束与文档同步机制；  
  - `docs/index.md`：文档导航与类型说明；  
  - `docs/status.md`：当前项目状态总览；  
  - `docs/principles.md`：文档 / 代码 / 测试 / 管理通用原则；  
  - `docs/plans.md`：本文件，用于描述各子系统的过去 / 现在 / 未来。  
- 明确文档命名与职责边界：`*_intro.md`（架构/说明）、`*_journey.md`（历程/决策）、ops 文档（如 `repl.md`、`troubleshooting.md`）。

### 5.2 正在进行的工作（Present）

- 通过对现有文档的整理与补充，让 LLM 在回答问题和生成文档时：  
  - 能够主动查找并使用 `index.md` / `status.md` / `principles.md` / `plans.md` 作为上下文；  
  - 在进行代码修改时，优先考虑是否需要同步相关文档。  
- 使用 `status.md` 和本 `plans.md` 为后续 intro/journey 文档的撰写提供“事实基线”。

### 5.3 可能的下一步（Near Future）

- 逐步补充关键模块的 intro 文档：  
  - 优先级建议：`general_intro.md` → `aimassistant_intro.md` → `vision_intro.md` / `bot_intro.md` → `skill_intro.md`。  
- 为较为稳定的模块撰写首批 `*_journey.md`：  
  - 建议从自瞄或视觉模块开始，记录性能调优和设计取舍。  
- 视实际需要新增运维/操作类文档：  
  - `repl.md`：REPL 调试工具使用说明；  
  - `troubleshooting.md`：常见问题与排查步骤；  
  - 如有必要，再引入更细分的 ops 文档（例如部署指南、环境准备说明等）。

---

## 6. 如何使用本文件（For Humans & LLMs）

- **对于人类维护者**：  
  - 当你规划下一个阶段的工作时，可以先查看对应子系统的小节（如自瞄、视觉），再将更详细的任务拆分到 issue / 待办列表中；  
  - 当你完成一个重要里程碑时，可以同时更新 `status.md` 与本 `plans.md`，保持“当前状态”与“未来计划”的一致性。

- **对于 LLM 协作助手**：  
  - 在生成设计文档或规划建议前，应优先阅读：`status.md` + `plans.md` + `principles.md`；  
  - 若发现当前行为与这些文档中约定的原则或计划不一致，应主动提出并询问维护者是否需要调整计划或原则；  
  - 在提出新计划时，应尽量沿用本文件的结构与术语（子系统划分、命名约定等），以便人类与其他 LLM 协作者理解与对齐。
